<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: var(--primary);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-success {
            background-color: var(--success);
            border-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--danger);
            border-color: var(--danger);
        }
        
        .status-pending {
            color: var(--primary);
            background-color: rgba(52, 152, 219, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .status-accepted {
            color: var(--success);
            background-color: rgba(46, 204, 113, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .status-rejected {
            color: var(--danger);
            background-color: rgba(231, 76, 60, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .help-icon {
            cursor: pointer;
            color: var(--primary);
            margin-right: 5px;
        }
        
        .teacher-link {
            background-color: rgba(52, 152, 219, 0.1);
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
        }
        
        .logo {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .hidden {
            display: none;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .upload-area i {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 15px;
        }
        
        .file-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <nav class="navbar navbar-light bg-white rounded shadow-sm mb-4">
            <div class="container-fluid">
                <a class="navbar-brand logo" href="#" onclick="showAdminPanel()">
                    <i class="fas fa-graduation-cap me-2"></i>Ù†Ø¸Ø§Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
                </a>
            </div>
        </nav>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… -->
        <div class="card" id="admin-panel">
            <div class="card-header">
                <i class="fas fa-user-tie me-2"></i>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… (Admin Panel)
            </div>
            <div class="card-body">
                <form id="teacher-form">
                    <div class="mb-3">
                        <label for="teacher-name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</label>
                        <input type="text" class="form-control" id="teacher-name" placeholder="Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø· (Ø­Ø±ÙˆÙ ØµØºÙŠØ±Ø© ÙˆØ£Ø±Ù‚Ø§Ù…)" required pattern="[a-z0-9]+">
                        <div class="form-text">ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ØµØºÙŠØ±Ø© ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="bot-token" class="form-label">
                            ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª
                            <i class="fas fa-question-circle help-icon" onclick="window.open('https://youtu.be/QVBdIThA3II?si=AEgSzy1UqltRykeG', '_blank')"></i>
                        </label>
                        <input type="text" class="form-control" id="bot-token" placeholder="Ø£Ø¯Ø®Ù„ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="teacher-id" class="form-label">
                            ID Ø§Ù„Ø­Ø³Ø§Ø¨
                            <i class="fas fa-question-circle help-icon" onclick="window.open('https://youtu.be/Xl3blDReCzs?si=JJ6qdIVyYMhT2VYL', '_blank')"></i>
                        </label>
                        <input type="text" class="form-control" id="teacher-id" placeholder="Ø£Ø¯Ø®Ù„ ID Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-check-circle me-2"></i>ØªØ£ÙƒÙŠØ¯
                    </button>
                </form>
                
                <div id="success-message" class="alert alert-success mt-3 hidden">
                    <i class="fas fa-check-circle me-2"></i>
                    <span id="message-text">Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ù†Ø¬Ø§Ø­ âœ…</span>
                    <div class="mt-2">
                        <strong>Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ø±ÙØ¹:</strong>
                        <div class="teacher-link mt-1" id="teacher-link"></div>
                    </div>
                    <div class="mt-2 text-muted">
                        <small>ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø·Ù„Ø§Ø¨Ùƒ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØµÙØ­Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø·Ù„Ø§Ø¨ -->
        <div class="card hidden" id="upload-page">
            <div class="card-header">
                <i class="fas fa-cloud-upload-alt me-2"></i>Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            </div>
            <div class="card-body">
                <form id="upload-form">
                    <div class="mb-3">
                        <label for="student-name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                        <input type="text" class="form-control" id="student-name" required>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="student-group" class="form-label">Ø§Ù„Ø¬Ø±ÙˆØ¨</label>
                            <input type="text" class="form-control" id="student-group" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="student-section" class="form-label">Ø§Ù„Ø³ÙƒØ´Ù†</label>
                            <input type="text" class="form-control" id="student-section" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="student-comment" class="form-label">ØªØ¹Ù„ÙŠÙ‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <textarea class="form-control" id="student-comment" rows="2"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Ø±ÙØ¹ Ù…Ù„Ù</label>
                        <div class="upload-area" id="upload-area">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§</p>
                            <p class="text-muted">(PDF, PPT, XLS, DOC, ÙˆØºÙŠØ±Ù‡Ø§)</p>
                        </div>
                        <input type="file" id="file-input" class="hidden" accept=".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.zip,.rar">
                        <div class="file-info hidden" id="file-info">
                            <i class="fas fa-file me-2"></i>
                            <span id="file-name"></span>
                            <button type="button" class="btn btn-sm btn-danger ms-2" onclick="removeFile()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success w-100" id="submit-btn">
                        <i class="fas fa-paper-plane me-2"></i>Ø¥Ø±Ø³Ø§Ù„
                    </button>
                </form>
                
                <div id="upload-status" class="mt-3"></div>
                
                <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
                <div class="mt-4" id="previous-uploads">
                    <h5>Ù…Ù„ÙØ§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h5>
                    <div id="uploads-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBmPMRk4pvowUnqQb3fCSTZqLRNiU6-ouo",
            authDomain: "marvel1-654dd.firebaseapp.com",
            databaseURL: "https://marvel1-654dd-default-rtdb.firebaseio.com",
            projectId: "marvel1-654dd",
            storageBucket: "marvel1-654dd.appspot.com",
            messagingSenderId: "189921979866",
            appId: "1:189921979866:android:95f48de58a69756be924e3"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentTeacher = null;
        let selectedFile = null;
        let studentId = null;
        
        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ù„Ù… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
            const urlParams = new URLSearchParams(window.location.search);
            const teacherName = urlParams.get('teacher');
            
            if (teacherName) {
                loadTeacherPage(teacherName);
            } else {
                showAdminPanel();
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
            document.getElementById('teacher-form').addEventListener('submit', handleTeacherSubmit);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø±ÙØ¹
            document.getElementById('upload-form').addEventListener('submit', handleFileUpload);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹
            document.getElementById('upload-area').addEventListener('click', () => {
                document.getElementById('file-input').click();
            });
            
            document.getElementById('file-input').addEventListener('change', handleFileSelect);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª
            const uploadArea = document.getElementById('upload-area');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--primary)';
                uploadArea.style.backgroundColor = 'rgba(52, 152, 219, 0.1)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = '';
                
                if (e.dataTransfer.files.length) {
                    handleFileSelect({ target: { files: e.dataTransfer.files } });
                }
            });
        });
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…
        function handleTeacherSubmit(e) {
            e.preventDefault();
            
            const teacherName = document.getElementById('teacher-name').value;
            const botToken = document.getElementById('bot-token').value;
            const teacherId = document.getElementById('teacher-id').value;
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙˆØª
            testBot(botToken, teacherId, teacherName);
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙˆØª
        function testBot(botToken, teacherId, teacherName) {
            const message = `âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø¨ÙˆØª Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…: ${teacherName}\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…Ù„ÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨.`;
            
            fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chat_id: teacherId,
                    text: message
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… ÙÙŠ Firebase
                    saveTeacherData(teacherName, botToken, teacherId);
                    
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                    document.getElementById('success-message').classList.remove('hidden');
                    document.getElementById('teacher-link').textContent = 
                        `${window.location.origin}${window.location.pathname}?teacher=${teacherName}`;
                    
                    // Ø­ÙØ¸ ÙÙŠ LocalStorage
                    localStorage.setItem('teacherData', JSON.stringify({
                        name: teacherName,
                        token: botToken,
                        id: teacherId
                    }));
                } else {
                    alert('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† ÙˆID ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙˆØª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† ÙˆID ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            });
        }
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… ÙÙŠ Firebase
        function saveTeacherData(teacherName, botToken, teacherId) {
            const teacherData = {
                name: teacherName,
                token: botToken,
                id: teacherId,
                createdAt: new Date().toISOString()
            };
            
            database.ref('teachers/' + teacherName).set(teacherData)
            .then(() => {
                console.log('Teacher data saved successfully');
            })
            .catch(error => {
                console.error('Error saving teacher data:', error);
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
        function loadTeacherPage(teacherName) {
            database.ref('teachers/' + teacherName).once('value')
            .then(snapshot => {
                if (snapshot.exists()) {
                    currentTeacher = snapshot.val();
                    showUploadPage();
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø·Ø§Ù„Ø¨ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
                    if (!localStorage.getItem('studentId')) {
                        studentId = 'student_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        localStorage.setItem('studentId', studentId);
                    } else {
                        studentId = localStorage.getItem('studentId');
                    }
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„Ø·Ø§Ù„Ø¨
                    loadPreviousUploads(teacherName);
                } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.');
                    showAdminPanel();
                }
            })
            .catch(error => {
                console.error('Error loading teacher:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù….');
                showAdminPanel();
            });
        }
        
        // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
        function showAdminPanel() {
            document.getElementById('admin-panel').classList.remove('hidden');
            document.getElementById('upload-page').classList.add('hidden');
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            const savedData = localStorage.getItem('teacherData');
            if (savedData) {
                const data = JSON.parse(savedData);
                document.getElementById('teacher-name').value = data.name || '';
                document.getElementById('bot-token').value = data.token || '';
                document.getElementById('teacher-id').value = data.id || '';
            }
        }
        
        // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø±ÙØ¹
        function showUploadPage() {
            document.getElementById('admin-panel').classList.add('hidden');
            document.getElementById('upload-page').classList.remove('hidden');
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('file-name').textContent = file.name;
                document.getElementById('file-info').classList.remove('hidden');
                document.getElementById('upload-area').classList.add('hidden');
            }
        }
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø±
        function removeFile() {
            selectedFile = null;
            document.getElementById('file-input').value = '';
            document.getElementById('file-info').classList.add('hidden');
            document.getElementById('upload-area').classList.remove('hidden');
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
        function handleFileUpload(e) {
            e.preventDefault();
            
            if (!selectedFile) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ø±ÙØ¹Ù‡');
                return;
            }
            
            const studentName = document.getElementById('student-name').value;
            const studentGroup = document.getElementById('student-group').value;
            const studentSection = document.getElementById('student-section').value;
            const studentComment = document.getElementById('student-comment').value;
            
            // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ§Ù†Ø§Øª Ø«Ù†Ø§Ø¦ÙŠØ©
            const reader = new FileReader();
            reader.onload = function(event) {
                const fileData = event.target.result;
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
                const uploadData = {
                    studentName: studentName,
                    studentGroup: studentGroup,
                    studentSection: studentSection,
                    studentComment: studentComment,
                    fileName: selectedFile.name,
                    fileType: selectedFile.type,
                    fileSize: selectedFile.size,
                    status: 'pending',
                    timestamp: new Date().toISOString(),
                    studentId: studentId
                };
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ÙØ¹ ÙÙŠ Firebase
                saveUploadData(currentTeacher.name, uploadData, fileData);
            };
            reader.readAsDataURL(selectedFile);
        }
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ÙØ¹ ÙÙŠ Firebase
        function saveUploadData(teacherName, uploadData, fileData) {
            const uploadId = 'upload_' + Date.now();
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ÙØ¹
            database.ref('uploads/' + teacherName + '/' + uploadId).set(uploadData)
            .then(() => {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
                sendToTelegramBot(teacherName, uploadData, fileData, uploadId);
            })
            .catch(error => {
                console.error('Error saving upload data:', error);
                showUploadStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'danger');
                resetSubmitButton();
            });
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        function sendToTelegramBot(teacherName, uploadData, fileData, uploadId) {
            const message = `
ğŸ“ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø·Ø§Ù„Ø¨:
            
Ø§Ù„Ø§Ø³Ù…: ${uploadData.studentName}
Ø§Ù„Ø¬Ø±ÙˆØ¨: ${uploadData.studentGroup}
Ø§Ù„Ø³ÙƒØ´Ù†: ${uploadData.studentSection}
${uploadData.studentComment ? `Ø§Ù„ØªØ¹Ù„ÙŠÙ‚: ${uploadData.studentComment}` : ''}
Ø§Ù„Ù…Ù„Ù: ${uploadData.fileName} (${formatFileSize(uploadData.fileSize)})
            
Ù…Ø¹Ø±Ù Ø§Ù„Ø±ÙØ¹: ${uploadId}
            `.trim();
            
            // Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØµÙŠØ©
            fetch(`https://api.telegram.org/bot${currentTeacher.token}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chat_id: currentTeacher.id,
                    text: message,
                    reply_markup: {
                        inline_keyboard: [
                            [
                                { text: "âœ… Ù‚Ø¨ÙˆÙ„", callback_data: `accept_${uploadId}` },
                                { text: "âŒ Ø±ÙØ¶", callback_data: `reject_${uploadId}` }
                            ]
                        ]
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    // Ø«Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù
                    return fetch(`https://api.telegram.org/bot${currentTeacher.token}/sendDocument`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: currentTeacher.id,
                            document: fileData,
                            caption: `Ø§Ù„Ù…Ù„Ù: ${uploadData.fileName}`
                        })
                    });
                } else {
                    throw new Error('Failed to send message');
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    showUploadStatus('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­. ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¹Ù„Ù….', 'primary');
                    resetForm();
                } else {
                    throw new Error('Failed to send file');
                }
            })
            .catch(error => {
                console.error('Error sending to Telegram:', error);
                showUploadStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'danger');
            })
            .finally(() => {
                resetSubmitButton();
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙÙˆØ¹Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        function loadPreviousUploads(teacherName) {
            database.ref('uploads/' + teacherName).orderByChild('studentId').equalTo(studentId).on('value', (snapshot) => {
                const uploadsList = document.getElementById('uploads-list');
                uploadsList.innerHTML = '';
                
                if (!snapshot.exists()) {
                    document.getElementById('previous-uploads').classList.add('hidden');
                    return;
                }
                
                document.getElementById('previous-uploads').classList.remove('hidden');
                
                snapshot.forEach((childSnapshot) => {
                    const upload = childSnapshot.val();
                    const uploadId = childSnapshot.key;
                    
                    const uploadElement = document.createElement('div');
                    uploadElement.className = 'card mb-2';
                    uploadElement.innerHTML = `
                        <div class="card-body py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>${upload.fileName}</strong>
                                    <div class="text-muted small">
                                        ${upload.studentGroup} - ${upload.studentSection} - ${formatDate(upload.timestamp)}
                                    </div>
                                </div>
                                <div class="status-${upload.status}">${getStatusText(upload.status)}</div>
                            </div>
                        </div>
                    `;
                    
                    uploadsList.appendChild(uploadElement);
                });
            });
        }
        
        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹
        function showUploadStatus(message, type) {
            const statusElement = document.getElementById('upload-status');
            statusElement.innerHTML = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                statusElement.innerHTML = '';
            }, 5000);
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        function resetSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Ø¥Ø±Ø³Ø§Ù„';
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
        function resetForm() {
            document.getElementById('upload-form').reset();
            removeFile();
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG') + ' ' + date.toLocaleTimeString('ar-EG');
        }
        
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± - ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±ÙØ¹';
                case 'accepted': return 'ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­';
                case 'rejected': return 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ù„Ù';
                default: return status;
            }
        }
    </script>
</body>
</html>